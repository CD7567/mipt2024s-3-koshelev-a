# Individual task
Протяженные 2d объекты: для маски нахождение осевой линии и сглаживание контура

## Описание задачи

**Входные данные:** `.png` изображение с маской - замкнутый протяженный контур.

**Выходные данные:** в одном из доступных форматов векторной графики вывести сглаженную версию контура и осевую линию.

## Генератор

Реализована алгоритмическая генерация данных, результатом которой является протяженная фигура с зашумленным контуром.
Пример сгенерированных изображений можно найти ниже в секции про само приложение.

### Описание

В алгоритме реализован метод случайных блужданий с коррекцией траектории. Опишем шаги работы алгоритма:
1) Выбирается начальная точка
2) Строится абсолютно случайно первый шаг
3) Рассчитывается центростремительная сила (tension), сила отталкивания от предыдущих вершин (repel) и вклад предыдущего направления (momentum). Производится взвешенное усреднение для выбора ориентации следующего шага
4) Случайно выбирается направление следующего шага в конусе видимости вокруг выбранного в пункте 3 направления
5) Повторяются шаги 3-4, пока не будет отрисовано требуемое количество шагов
6) Определяется контур полученной фигуры и каждая его точка случайно смещается на небольшой сдвиг
7) Отрисовывается контур из пункта 6
8) Сохраняется сгенерированное изображение

### Конфигурация

Приведем пример блока генератора в файле конфигурации и опишем значение переменных:

```toml
[generator]
# Ширина кисти при отрисовке фигуры в пунктах 1-5
strokeWidth = 80
# Длина одного звена фигуры в пунктах 1-5
step = 80.0
# Полураствор конуса видимости из пункта 4 в долях числа пи
fov = 0.125
# Ограничение на положение точки из пункта 1 в долях размера изображения
initialBound = 0.25
# Вес моментума для пункта 3
momentumFactor = 0.8
# Вес центростремительной силы для пункта 3
tensionFactor = 0.8
# Вес силы отталкивания для пункта 3
repelFactor = 1.0
# Размер рандомизации для пункта 6 в долях strokeWidth
imperfectionFactor = 0.1
```

### Запуск

Приведем сигнатуру команды запуска генератора:
```bash
./gen width height segmentNum destName
```

Где:
- `width`, `height` - ширина и высота изображения в пикселях
- `segmentNum` - число сегментов фигуры
- `destName` - имя выходного файла

#### Release
Уровень логгирования ограничен `INFO` сообщениями, не сохраняются отладочные изображения.

#### Debug
Уровень логгинга ограничен `DEBUG` сообщениями, сохраняются отладочные изображения.


## Приложение

Реализовано приложение по сглаживанию контура протяженной фигуры и отрисовке средней линии.
Приведем сразу примеры работы алгоритма на сгенерированных упомянутым ранее генератором изображениях.
Показаны пары до и после обработки с разрешениями 128x128, 256x256, 512x512, 1024x1024.

<img src="data/regular/128.png" alt="Исходное изображение" style="width: 49%; height: auto;"/>
<img src="data/regular/128_proc.png" alt="Обработанное изображение" style="width: 49%; height: auto;"/>

<img src="data/regular/256.png" alt="Исходное изображение" style="width: 49%; height: auto;"/>
<img src="data/regular/256_proc.png" alt="Обработанное изображение" style="width: 49%; height: auto;"/>

<img src="data/regular/512.png" alt="Исходное изображение" style="width: 49%; height: auto;"/>
<img src="data/regular/512_proc.png" alt="Обработанное изображение" style="width: 49%; height: auto;"/>

<img src="data/regular/1024.png" alt="Исходное изображение" style="width: 49%; height: auto;"/>
<img src="data/regular/1024_proc.png" alt="Обработанное изображение" style="width: 49%; height: auto;"/>

### Описание

Распишем работу обработчика пошагово:
1) Усредняющее сглаживание (medianBlur), оно показало оптимальные по качеству результаты с точки зрения отброса дефектов при сохранении контура
2) Детектирование полученного сглаженного контура
3) Дополнение исходной фигуры по внутренности контура
4) Скелетонизация изображения алгоритмом Чанг-Суэна (Zhang-Suen)
5) Детектирование контура на скелетонизированном изображении для нахождения средней линии
6) Отрисовка сглаженного контура и средней линии
7) Сохранение результата обработки

### Конфигурация

Приведем пример блока приложения в файле конфигурации и опишем значение переменных:

```toml
[main]
# Ширина кисти для пункта 6
strokeWidth = 1
# Размер ядра сглаживания для пункта 1
kernelSize = 9
```

### Запуск

Приведем сигнатуру команды запуска приложения:
```bash
./main srcName
```

Где:
- `srcName` - имя выходного файла

#### Release
Уровень логгирования ограничен `INFO` сообщениями, не сохраняются отладочные изображения.

#### Debug
Уровень логгинга ограничен `DEBUG` сообщениями, сохраняются отладочные изображения.
